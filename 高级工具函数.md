# localStorage的已使用空间

在较新的chrome上测试，localStorage的存储是按照字符个数来算的。包含键和值的。
所以在测试代码中，你把a修改啊，不会影响存储的数量。但是键的长度，会影响存储的数量。

```

function getLSUsedSpace() {
    return Object.keys(localStorage).reduce((total, curKey) => {
        if (!localStorage.hasOwnProperty(curKey)) {
            return total;
        }
        total += localStorage[curKey].length + curKey.length;
        return total;
    }, 0)
}
```

### 示例

```
localStorage.clear();
localStorage.a = "啊";
console.log(getLSUsedSpace()); // 2
```

### 溢出测试：

`key`的值为长度为10的 `kkkkkkkkkk`:

输出结果：Max: 5242880 value Length: 5242870

当你把`key`修改长度为1的`k`:

输出结果：Max: 5242880 value Length: 5242879

```
localStorage.clear();
let valLength = 0
try {
    let str = Array.from({ length: 5242800 }, () => "啊").join("");
    valLength = str.length;
    for (let i = 0; i < 10000000000000; i++) {
        str += "a"
        valLength += 1;
        localStorage.setItem(`kkkkkkkkkk`, str);
    }

} catch (err) {
    console.error("存储失败", err);
    console.log("Max:", getLSUsedSpace(), " value Length:", valLength)
}
```